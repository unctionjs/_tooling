#!/usr/bin/env ruby

require_relative "../source/unctionjs"

include Unctionjs::Context::Regular

Unctionjs.command do |let|
  let.array "--packages", "the package names"
  let.string "--type", "the type of dependency: dependencies, devDependencies, etc"
end

with do |name|
  if Unctionjs.options["packages"].empty?
    `cd ../#{name} && npm install --no-progress`
  else
    case Unctionjs.options["type"]
    when "devDependencies"
      `cd ../#{name} && npm install --no-progress --save-dev #{Unctionjs.options["packages"].join(" ")}`
    when "dependencies"
      `cd ../#{name} && npm install --no-progress --save #{Unctionjs.options["packages"].join(" ")}`
    when "peerDependencies"
      `cd ../#{name} && npm install --no-progress --save-peer #{Unctionjs.options["packages"].join(" ")}`
    else raise ArgumentError, "--type is required if --packages is specified"
    end
  end
end
